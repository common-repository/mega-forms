/* (c) 2024 Mega Forms - https://wpmegaforms.com */
!function(c,p){"use strict";const _={forms:null,filters:{},isFormSubmitProcessing:!1,skipFormSubmitHandler:!1,add_filter:function(e,r){this.filters[e]||(this.filters[e]=[]);this.filters[e].push(r)},apply_filter:async function(r,e,s={}){if(this.filters[r])for(var t of this.filters[r])try{var n=await t(e,s);void 0!==n&&(e=n)}catch(e){console.error(`Error in ${r} filter callback:`,e)}return e},init:function(){this.forms=c(".single-mega-form");if(0<this.forms.length){this.initEvents();this.initActions()}},initEvents:function(){c(document).on("click",".mf-submit-btn, .mf-save-btn, .mf-prev-btn, .mf-next-btn",function(e){e.currentTarget.classList.contains("mf-submit-btn")?_.submitForm.apply(this,[e]):e.currentTarget.classList.contains("mf-save-btn")?_.saveForm.apply(this,[e]):e.currentTarget.classList.contains("mf-prev-btn")?_.prevFormPage.apply(this,[e]):e.currentTarget.classList.contains("mf-next-btn")&&_.nextFormPage.apply(this,[e])});c(document).on("keydown",".mform_page input",async function(e){if(13==(e.keyCode||e.which)){e.preventDefault();var r=c(this).closest(".mform_page"),s=c(r).closest("form"),t=c(r).find(".mf-next-btn"),n=c(s).hasClass("ajax-mega-form");if(0<t.length)c(s).hasClass("ajax-mega-form")?_.nextFormPage.apply(t,[e]):c(t).click();else{t=c(r).find(".mf-submit-btn");n?_.submitForm.apply(t,[e]):c(t).click()}}});0<c('input[name="_mf_auto_advance"]').length&&0<c(".ajax-mega-form").length&&c(document).on("change",".mform_page input, .mform_page select, .mform_page textarea",function(){var e=c(this).closest(".mform_page"),r=c(e).closest("form"),s=parseInt(c(r).find('[name="_mf_current_page"]').val()),r=c(r).find('input[name="_mf_auto_advance"]').val();if(r&&("all"===r||r.split(",").includes(s.toString())))if(0===c(e).find("input, select, textarea").filter(function(){return""===this.value}).length){r=c(e).find(".mf-next-btn");0<r.length&&_.nextFormPage.apply(r,[new c.Event("click")])}})},initActions:function(){p.conditionalFields(this.forms,{disableHidden:!0,debug:p.dev_env})},prevFormPage:function(e){var r,s=c(this).closest(".mform_page"),t=c(s).closest("form");if(0<s.length){e.preventDefault();e=c(s).prev(".mform_page");r=parseInt(c(t).find('[name="_mf_current_page"]').val())-1;c(s).hide();c(e).show();_.updateProgressIndicator(c(e).closest("form"),r);c(t).find(".mform_response_msg").empty().addClass("mf_hidden");c(t).find(".mf-notice-holder").remove();c(t).find(".mf_input_error").removeClass("mf_input_error");c(t).find(".mf_compound_error").removeClass("mf_compound_error");c(t).find(".mf_sub_input_error").removeClass("mf_sub_input_error")}},nextFormPage:function(e){var r=c(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=p.serializeForm(r);_.ajaxSubmitForm(r,e,"page",{page:e._mf_current_page})}},saveForm:function(e){var r=c(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=p.serializeForm(r);_.ajaxSubmitForm(r,e,"save")}},submitForm:function(e){if(_.isFormSubmitProcessing)e.preventDefault();else{if(_.skipFormSubmitHandler)return!(_.skipFormSubmitHandler=!1);e.preventDefault();e.stopPropagation();_.isFormSubmitProcessing=!0;const r=c(this).closest("form"),s=r.hasClass("ajax-mega-form"),t=c(this);(async()=>{await p.do_action("beforeFormSubmit",{form:r[0],isAjax:s});if(s){var e=p.serializeForm(r);_.ajaxSubmitForm(r,e);_.isFormSubmitProcessing=!1}else{_.skipFormSubmitHandler=!0;_.isFormSubmitProcessing=!1;c(t).click()}})()}},updateProgressIndicator:function(e,s){var r=c(e).find(".mform_pages_progress_indicator");if(0<r.length)if(0==s)c(r).remove();else if(c(r).hasClass("mform_progress_bar")){var t=c(r).find(".mf_progressbar_percentage"),n=c(t).attr("data-count")||c(e).find(".mform_page").length,n=parseInt(s)/parseInt(n)*100;c(t).css("width",n+"%");c(t).find("span").text(parseInt(n)+"%");c(t).removeClass(function(e,r){return(r.match(/percentbar_\d{1,3}/g)||[]).join(" ")});c(t).addClass("percentbar_"+parseInt(n))}else if(c(r).hasClass("mform_steps")){t=c(r).find(".mf_step");c(t).each(function(e){var r=c(this).attr("data-number")||c(this).find(".mf_step_number").text(),r=parseInt(r);c(this).removeClass("mf_step_active mf_step_pending mf_step_completed");r==s?c(this).addClass("mf_step_active"):s<r?c(this).addClass("mf_step_pending"):c(this).addClass("mf_step_completed")})}c(e).find('[name="_mf_current_page"]').val(s)},isVisible:function(e){var r=c(e).offset().top,e=r+c(e).outerHeight(),s=c(window).scrollTop(),t=s+c(window).height();return s<e&&r<t},maybeGetFileInputs:function(e){let r={},s=jQuery(e).find('[type="file"].mf-upload');0<s.length&&jQuery.each(s,function(){!this.hasAttribute("multiple")&&0<this.files.length&&(r[this.name]=this.files[0])});return r},ajaxSubmitForm:async function(o,e,a="",r={}){let f=Object.prototype.hasOwnProperty.call(e,"_mf_form_id")?e._mf_form_id:"";if(void 0!==f&&""!==f){let s={form_id:f,posted_data:e,context:a,args:r},t=!1,n=!1,i=!1;if("page"==a||"save"==a){i=r.page||e._mf_current_page;n=c(o).find(".mform_page_"+i);t="page"==a?c(n).find(".mf-next-btn"):c(n).find(".mf-save-btn")}else t=c(o).find('[name="mform_submit"]');c(o).addClass("mf-mask");c(t).addClass("mf-submit-processing").append('<span class="mf-dots-spinner"> <i class="mf-dot"></i> <i class="mf-dot"></i> <i class="mf-dot"></i> </span>');s.posted_data=await p.apply_filter("ajaxSubmissionPostedData",s.posted_data,{form:o[0],formId:f,button:t[0],context:a});var m=_.maybeGetFileInputs(o);if(0<Object.keys(m).length){let e=new FormData,r=!1;s.args.refresh_fields=[];for(var l in m){e.append(l,m[l]);s.args.refresh_fields.push(l)}for(var d in s)if("object"==typeof s[d]){r=!0;e.append(d,JSON.stringify(s[d]))}else e.append(d,s[d]);e.append("has_json",r);s=e}p.ajax({data:s,isadmin:!1,callback:"submit_form",success:function(r){if(p.dev_env){console.log("%cSuccess","color: green; background: yellow; font-size: 20px");console.log(r)}if("redirect"in r)window.location.href=r.redirect;else{c(o).removeClass("mf-mask");c(t).removeClass("mf-submit-processing");c(t).find(".mf-dots-spinner").remove();if("page"==a){c(o).find(".mform_response_msg").empty().addClass("mf_hidden");c(o).find(".mf-notice-holder").remove();c(o).find(".mf_input_error").removeClass("mf_input_error");c(o).find(".mf_compound_error").removeClass("mf_compound_error");c(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");var e=c(n).next(),s=parseInt(i)+1;c(n).hide();c(e).show();_.updateProgressIndicator(o,s)}else{c(o).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);c(o).find(".mf-notice-holder").remove();c(o).find(".mf_input_error").removeClass("mf_input_error");c(o).find(".mf_compound_error").removeClass("mf_compound_error");c(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");if("keep_form"in r&&!1!==r.keep_form){c(o).find(":input").each(function(e,r){c(r).attr("name").startsWith("_mf_")||c(r).val("")});c(o).find(":checked").prop("checked",!1)}else if(0<c(o).find(".mform_pages").length)c(o).find(".mform_pages").remove();else{c(o).find(".mform_body").remove();c(o).find(".mform_footer").remove()}}"hideProgressIndicator"in r&&r.hideProgressIndicator&&_.updateProgressIndicator(o,!1);if("refreshedFields"in r&&r.refreshedFields){let e=r.refreshedFieldsContainer||".mform_container",s=c(o).closest(e);s&&Object.entries(r.refreshedFields).forEach(([e,r])=>{s.find(e).each(function(){c(this).replaceWith(r)})})}if("scrollTop"in r&&r.scrollTop&&!_.isVisible(c(o).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<c("response.scrollTop").length&&(e=r.scrollTop);c(e).animate({scrollTop:c(o).find(".mform_header").offset().top-80},500)}}},fail:function(r){if(p.dev_env){console.log("%cFail","color: red; background: yellow; font-size: 20px");console.log(r)}c(o).removeClass("mf-mask");c(t).removeClass("mf-submit-processing");c(t).find(".mf-dots-spinner").remove();c(o).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);c(o).find(".mf-notice-holder").remove();c(o).find(".mf_input_error").removeClass("mf_input_error");c(o).find(".mf_compound_error").removeClass("mf_compound_error");c(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");"notices"in r&&0<Object.keys(r.notices).length&&Object.entries(r.notices).forEach(([r,s])=>{var t=c(o).find('[name="'+r+'"]');if(0<c(t).length){t=c(t).closest(".mf_input_container");c(t).append(s);c(t).addClass("mf_input_error")}else{t=c(o).find('[name^="'+r+'["]');let e=null;if(0<c(t).length)e=c(t).closest(".mf_input_container");else{t=r.replace(/.*mfield_/,""),r=c(o).find("#mf_"+f+"_field_"+t);e=c(r).find(".mf_input_container")}e.append(s);e.addClass("mf_input_error")}});"compound_notices"in r&&0<Object.keys(r.compound_notices).length&&Object.entries(r.compound_notices).forEach(([n,e])=>{0<Object.keys(e).length&&Object.entries(e).forEach(([e,r])=>{var e=c(o).find('[name="'+n+"["+e+']"]'),s=c(e).parent(".mf_sub_field"),t=c(e).closest(".mf_input_container");c(e).after(r);c(s).addClass("mf_sub_input_error");c(t).addClass("mf_compound_error")})});"refreshedFields"in r&&r.refreshedFields&&c.each(r.refreshedFields,function(e,r){c(e).replaceWith(r)});if("scrollTop"in r&&r.scrollTop&&!_.isVisible(c(o).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<c("response.scrollTop").length&&(e=r.scrollTop);c(e).animate({scrollTop:c(o).find(".mform_header").offset().top-80},500)}}})}}};p.publicPro=_;c(window).load(function(){_.init()});_}(jQuery,megaForms,mfVars);