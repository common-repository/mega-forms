/* (c) 2024 Mega Forms - https://wpmegaforms.com */
"use strict";const megaForms={context:mfCommonVars.context,ajaxurl:mfCommonVars.ajaxurl,dev_env:mfCommonVars.dev_env,ajax_public_action:"megaforms_public_request",ajax_admin_action:"megaforms_admin_request",actions:{},filters:{},add_action:function(e,t){this.actions[e]||(this.actions[e]=[]);this.actions[e].push(t)},do_action:async function(t,e){if(this.actions[t])for(var i of this.actions[t])try{await i(e)}catch(e){console.error(`Error in ${t} action callback:`,e)}},add_filter:function(e,t){this.filters[e]||(this.filters[e]=[]);this.filters[e].push(t)},apply_filter:async function(t,e,i={}){if(this.filters[t])for(var n of this.filters[t])try{var o=await n(e,i);void 0!==o&&(e=o)}catch(e){console.error(`Error in ${t} filter callback:`,e)}return e},ajax:(n,e="POST")=>{(n=n||{}).isadmin=n.isadmin||!1;n.data=n.data||{};n.callback=n.callback.replace(/-/g,"_")||"";n.before=n.before||!1;n.success=n.success||function(e){console.log(e)};n.fail=n.fail||function(e){console.log(e)};n.error=n.error||!1;n.complete=n.complete||!1;n.debug=n.debug||!1;let t="",i=n.data instanceof FormData,o={type:e,url:megaForms.ajaxurl,success:e=>{if(n.debug)n.success(e);else{e=JSON.parse(e);if(e.success){if(e.fail)"function"==typeof n.fail&&n.fail(e);else if("function"==typeof n.success){delete e.success;delete e.fail;n.success(e)}}else{n.isadmin?alert("AJAX error, check you browser console for more details."):alert("AJAX error, please refersh and try again.");console.log(e)}}},error:(e,t,i)=>{!1!==n.error&&"function"==typeof n.error&&n.error(e,t,i);console.log("XHR ERROR "+e.status+": "+i);n.isadmin?alert("Server side error, please error log file for more details."):alert("Server side error, please refersh and try again.")}};!1!==n.before&&"function"==typeof n.before&&(o.beforeSend=n.before());!1!==n.complete&&"function"==typeof n.complete&&(o.complete=n.complete());t=n.isadmin?megaForms.ajax_admin_action:megaForms.ajax_public_action;i?n.data.append("action",t):n.data.action=t;if(i){n.data.append("callback",n.callback);o.contentType=!1;o.processData=!1}else n.data.callback=n.callback;o.data=n.data;jQuery.ajax(o)},serializeForm:(e,t=!0)=>{let i={},n=t?jQuery(e).find(":input").serializeArrayLoose():jQuery(e).find(":input").serializeArray();jQuery.each(n,function(){var e=this.value,e=function e(t,i){if(t.length<1)return i;let n=t[0];"]"==n.slice(-1)&&(n=n.slice(0,-1));var o={};if(1==t.length)o[n=""==n?i:n]=i;else{t.shift();t=e(t,i);o[n]=t}return o}(this.name.split("["),e);jQuery.extend(!0,i,e)});return i}};if("undefined"!=typeof window){window.megaForms=megaForms;if("admin"==window.megaForms.context){window.wp=window.wp||{};window.megaForms.hooks=window.wp.hooks.createHooks()||{}}if("undefined"!=typeof mfConditionalFields)window.megaForms.conditionalFields=mfConditionalFields;else{const mfConditionalFields=(s,e={})=>{switch(typeof s){case"string":s=document.querySelectorAll(s);break;case"object":if(!1===Array.isArray(s)&&Object.prototype.hasOwnProperty.call(s,"0")){s=Object.fromEntries(Object.entries(s).filter(([e,t])=>!isNaN(e)&&void 0!==t.elements));s=Object.values(s)}else s=Array.isArray(s)?s:[s]}let l=e.rules||"inline",t=e.dynamic||!1,d=e.unsetHidden||!1,c=e.disableHidden||!1,i=e.debug||!1,f=e.depth||3,u=[],m=[],n=[],g={initField:(o,r)=>{var a=o.getAttribute("data-conditional-rules");if(0<a.length){let e="container"in(a=JSON.parse(a))?a.container:"",t="action"in a?a.action:"show",i="logic"in a?a.logic:"or",n="rules"in a?a.rules:[];if(0<(n="object"==typeof n&&void 0===n.length?[n]:n).length){for(let t=0;n.length>t;t++)if("group"in n[t])for(let e=0;n[t].group.length>e;e++)"name"in n[t].group[e]&&!m[r].includes(n[t].group[e].name)&&m[r].push(n[t].group[e].name);else"name"in n[t]&&!m[r].includes(n[t].name)&&m[r].push(n[t].name);o.removeAttribute("data-conditional-rules");o.mfConditionalContainerSelector=e;o.mfConditionalAction=t;o.mfConditionalLogic=i;o.mfConditionalRules=n;o.mfConditionalFormIndex=r;g.updateField(o)}}},updateField:(e,t=1)=>{let n=e.mfConditionalFormIndex,i=e.mfConditionalAction,o=e.mfConditionalLogic,r=e.mfConditionalRules,a=!1;if(0<r.length)for(let i=0;r.length>i;i++){let t=!1;if("group"in r[i]){var l,s=r[i].relation||"and";for(let e=0;r[i].group.length>e;e++){if(0==(l=g.evaluateRule(r[i].group[e],n))&&"and"==s){t=!1;break}if(l&&"or"==s){t=!0;break}t=l}}else t=g.evaluateRule(r[i],n);if(!1===t&&"and"==o){a=!1;break}if(t&&"or"==o){a=!0;break}a=t}a||(i="hide"==i?"show":"show"==i?"hide":"disable"==i?"enable":"enable"==i?"disable":"none");g.toggleField(e,i,t)},toggleField:(e,t,i)=>{let n=e.mfConditionalFormIndex,o=e.name,r=e.mfConditionalContainerSelector,a=null;if(i<f&&m[n].includes(o)){var l=g.getDependantField(o,n);if(0<l.length)for(let e=0;l.length>e;e++)"hide"==t?g.toggleField(l[e],"hide",i++):"show"==t&&g.updateField(l[e],i++)}if("hide"==t){""==r?e.setAttribute("hidden",!0):(a=e.closest(""+r))&&a.setAttribute("hidden",!0);c&&e.setAttribute("disabled","disabled");d&&("checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="")}else if("disable"==t)e.setAttribute("disabled","disabled");else if("enable"==t)e.hasAttribute("disabled")&&e.removeAttribute("disabled");else if("show"==t){""==r?e.removeAttribute("hidden"):(a=e.closest(""+r))&&a.removeAttribute("hidden");c&&e.removeAttribute("disabled")}},getDependantField:(i,t)=>{var n=[];if(void 0!==u[t])for(let e=0;u[t].length>e;e++)if("mfConditionalRules"in u[t][e]){var o=u[t][e].mfConditionalRules.some(t=>{if("group"in t){for(let e=0;t.group.length>e;e++)if(t.group[e].name===i)return!0;return!1}return t.name===i});void 0!==o&&!1!==o&&n.push(u[t][e])}return n},evaluateRule:(o,r)=>{var a=o.name,l=o.operator,o=o.value;if(m[r].includes(a)){let t=s[r].querySelectorAll('[name="'+a+'"]'),e,i,n;if(0<t.length){"radio"!==(e=t[0].type)&&"checkbox"!==e&&(t=t[0]);if("radio"==e||"checkbox"==e){i=[];for(let e=0;e<t.length;e++){t[e].checked&&i.push(t[e].value);e===t.length-1&&(i=i.join("|"))}}else i=t.value;n=g.compareValues(l,i,o)}return n}return!1},compareValues:(e,t,i)=>{t=t?t.toString().toLowerCase():"",i=i?i.toString().toLowerCase():"";switch(e){case"is":return i===t;case"isnot":return i!==t;case"greaterthan":return!isNaN(i)&&!isNaN(t)&&Number(i)>Number(t);case"lessthan":return!isNaN(i)&&!isNaN(t)&&Number(i)<Number(t);case"contains":return t.includes(i);case"doesnotcontain":return!t.includes(i);case"beginswith":return t.startsWith(i);case"doesnotbeginwith":return!t.startsWith(i);case"endswith":return t.endsWith(i);case"doesnotendwith":return!t.endsWith(i);case"isempty":return""===t;case"isnotempty":return""!==t}return!1},updateForm:async(r,e="add")=>{if(void 0!==s[r])if("add"==e)try{let i;i=await new Promise((e,t)=>{let i=[];if("inline"==l)i=s[r].querySelectorAll("[data-conditional-rules]");else{for(let t=0;l.length>t;t++)if("field"in l[t]){var n=(n=s[r].elements[l[t].field])instanceof RadioNodeList?Array.from(n):[n];for(let e=0;n.length>e;e++)if(void 0!==n[e]){var o=n[e];o.setAttribute("data-conditional-rules",JSON.stringify(l[t]));i.push(o)}delete l[t].field}l=null}if(0<i.length){u[r]=u[r].concat(Array.prototype.slice.call(i));e(i)}else t("No conditional fields found on step 1")});await new Promise((t,e)=>{if(0<i.length)for(let e=0;i.length>e;e++){g.initField(i[e],r);e===i.length-1&&t()}else e("No conditional fields to initialize on step 2")});if(0<m.length)for(let e=0;m[r].length>e;e++)if(!n[r].includes(m[r][e])){let t=s[r].querySelectorAll('[name="'+m[r][e]+'"]');if(0===t.length&&0<(t=s[r].querySelectorAll('[type="checkbox"][name="'+m[r][e]+'[]"]')).length){var o=m[r][e],a=(m[r][e]=m[r][e]+"[]",g.getDependantField(o,r));if(0<a.length)for(let n=0;a.length>n;n++)if(0<a[n].mfConditionalRules.length){let i=!1;for(let t=0;a[n].mfConditionalRules.length>t;t++)if("group"in a[n].mfConditionalRules[t]){for(let e=0;a[n].mfConditionalRules[t].group.length>e;e++)if(a[n].mfConditionalRules[t].group[e].name==o){a[n].mfConditionalRules[t].group[e].name=o+"[]";i=!0}}else if(a[n].mfConditionalRules[t].name==o){a[n].mfConditionalRules[t].name=o+"[]";i=!0}i&&g.updateField(a[n])}}if(0<t.length){for(let e=0;t.length>e;e++){t[e].mfConditionalFormIndex=r;t[e].addEventListener("change",g.fieldListener,!1)}n[r].push(m[r][e])}t=null}return!0}catch(t){if(i){let e="formIndex: "+r;void 0!==s[r].getAttribute("id")&&(e="formId: "+s[r].getAttribute("id"));console.info(e+" => "+t)}}else if("remove"==e){u[r]=u[r].filter(e=>void 0!==s[r].elements[""+e.name]);m[r]=m[r].filter(e=>void 0!==s[r].elements[""+e]);n[r]=n[r].filter(e=>void 0!==s[r].elements[""+e]);return!0}return!1},fieldListener:e=>{var t=g.getDependantField(e.target.name,e.target.mfConditionalFormIndex);if(0<t.length)for(let e=0;t.length>e;e++)g.updateField(t[e])},formListener:e=>{var t=e.target.mfConditionalFormIndex,e=e.detail.action;g.updateForm(t,e)}};if("block"==l){e=document.getElementById("rules-mf-conditional-fields");l=JSON.parse(e.innerHTML)}if("inline"!==l&&"object"!=typeof l)return i&&console.warn("The supplied rules or rule type is not valid."),!1;if(!(0<s.length))return i&&console.warn("The supplied conditional form was not found"),!1;for(let e=0;s.length>e;e++){u.push([]);m.push([]);n.push([]);s[e].mfConditionalFormIndex=e;g.updateForm(e)}if(t)for(let e=0;s.length>e;e++)s[e].addEventListener("mfConditionalFormUpdated",g.formListener,!1)};window.megaForms.conditionalFields=mfConditionalFields}window.megaForms.maxLengthHandler=e=>{var t=e.value.length,i=parseInt(e.getAttribute("maxlength"));i<t?e.value=e.value.substring(0,i):e.closest(".mf_input_container").querySelector("#mf_char_num").textContent=t+"/"+i};"undefined"!=typeof jQuery&&(jQuery.fn.serializeArrayLoose=function(){var n=/\r?\n/g,t=/^(?:submit|button|image|reset|file)$/i,i=/^(?:input|select|textarea|keygen)/i,o=/^(?:checkbox|radio)$/i;return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&i.test(this.nodeName)&&!t.test(e)&&(this.checked||!o.test(e))}).map(function(e,t){var i=jQuery(this).val();null==i&&(i="");return Array.isArray(i)?jQuery.map(i,function(e){return{name:t.name,value:e.replace(n,"\r\n")}}):{name:t.name,value:i.replace(n,"\r\n")}}).get()})}!function(r,a,l){const s={formID:0,init:function(){this.forms=r(".single-mega-form");0<this.forms.length&&this.initActions()},initActions:function(){r(".single-mega-form").each(function(e){s.ajaxMaybeResetFormNonceValues(r(this))});s.initDatePicker()},initDatePicker:function(){void 0!==r.fn.datepicker&&r(".mform_fields").find(".datepicker-here").each(function(){var e={},t=r(this).attr("data-date-from"),i=r(this).attr("data-date-to");e.language="en";e.minDate=t?new Date(t+"-01-01"):new Date;if(i)e.maxDate=new Date(i+"-12-31");else{e.maxDate=new Date;e.maxDate.setFullYear(e.maxDate.getFullYear()+9)}r(this).datepicker(e)})},getCookie:function(t){t+="=";var i=decodeURIComponent(document.cookie).split(";");for(let e=0;e<i.length;e++){var n=i[e].trim();if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null},setCookie:function(e,t,i){i=new Date(1e3*i).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+"; expires="+i+"; path=/; secure; samesite=strict"},ajaxMaybeResetFormNonceValues:function(t){var e=r(t).attr("data-id");if(void 0!==e&&""!==e){var i=this.getCookie(l.cookie),n=i?i.split("||")[0]:null,o=l.sid;i&&n===o?r(t).removeClass("mf-mask"):a.ajax({data:{form_id:e},isadmin:!1,callback:"get_form_nonce_values",success:function(e){if(a.dev_env){console.log("%cSuccess","color: green; background: yellow; font-size: 20px");console.log(e)}r(t).find('input[name="_mf_referrer"]').val(e.form_referrer);r(t).find('input[name="_mf_nonce"]').val(e.form_token);r(t).find('input[name="_mf_extra_nonce"]').val(e.wp_nonce);s.setCookie(l.cookie,e.cookie_value,e.cookie_expiration);r(t).removeClass("mf-mask")},fail:function(e){console.log("%cFail","color: red; background: yellow; font-size: 20px");console.log(e);r(t).removeClass("mf-mask")}})}}};r(window).load(function(){s.init()})}(jQuery,megaForms,mfVars);